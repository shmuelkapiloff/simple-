<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #005a87; }
        .result {
            background: #f0f0f0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        input, select {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>И Order API Test Suite</h1>
    <p>住 拽祝 注专转 转</p>

    <!-- Login Section -->
    <div class="test-section">
        <h2> 转专转</h2>
        <input type="email" id="email" placeholder="Email" value="test@example.com">
        <input type="password" id="password" placeholder="Password" value="password123">
        <button onclick="login()">转专</button>
        <button onclick="register()">专砖</button>
        <div id="loginResult" class="result"></div>
    </div>

    <!-- Cart Section -->
    <div class="test-section">
        <h2> 注转 拽转</h2>
        <input type="text" id="productId" placeholder="Product ID" value="675b0c74b0d49b4e3c123456">
        <input type="number" id="quantity" placeholder="Quantity" value="2" min="1">
        <button onclick="addToCart()">住祝 注</button>
        <button onclick="getCart()">爪 注</button>
        <button onclick="clearCart()">拽 注</button>
        <div id="cartResult" class="result"></div>
    </div>

    <!-- Order Section -->
    <div class="test-section">
        <h2> 转</h2>
        <div>
            <h3>转转 砖:</h3>
            <input type="text" id="street" placeholder="Street" value="Herzl 123">
            <input type="text" id="city" placeholder="City" value="Tel Aviv">
            <input type="text" id="postalCode" placeholder="Postal Code" value="12345">
            <input type="text" id="country" placeholder="Country" value="Israel">
        </div>
        <div>
            <select id="paymentMethod">
                <option value="credit_card">专住 砖专</option>
                <option value="paypal">PayPal</option>
                <option value="cash_on_delivery">转砖 </option>
            </select>
        </div>
        <button onclick="createOrder()">爪专 </button>
        <button onclick="getOrders()">爪 转</button>
        <div id="orderResult" class="result"></div>
    </div>

    <!-- Admin Section -->
    <div class="test-section">
        <h2> 驻注转 </h2>
        <input type="text" id="orderIdToCancel" placeholder="Order ID to cancel">
        <button onclick="cancelOrder()"> </button>
        <input type="text" id="orderIdToUpdate" placeholder="Order ID to update">
        <select id="newStatus">
            <option value="pending">转</option>
            <option value="processing">注</option>
            <option value="shipped">砖</option>
            <option value="delivered">住专</option>
            <option value="cancelled"></option>
        </select>
        <button onclick="updateOrderStatus()">注 住住</button>
        <div id="adminResult" class="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:4001/api';
        let authToken = localStorage.getItem('token');

        function showResult(elementId, data, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(data, null, 2);
            element.className = `result ${isSuccess ? 'success' : 'error'}`;
        }

        async function apiCall(endpoint, method = 'GET', body = null, useAuth = true) {
            const headers = {
                'Content-Type': 'application/json'
            };
            
            if (useAuth && authToken) {
                headers.Authorization = `Bearer ${authToken}`;
            }

            const config = {
                method,
                headers,
                body: body ? JSON.stringify(body) : null
            };

            try {
                const response = await fetch(`${API_BASE}${endpoint}`, config);
                const data = await response.json();
                return { success: response.ok, data, status: response.status };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // Authentication
        async function register() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            const result = await apiCall('/auth/register', 'POST', {
                name: 'Test User',
                email,
                password
            }, false);
            
            showResult('loginResult', result, result.success);
            if (result.success && result.data.data.token) {
                authToken = result.data.data.token;
                localStorage.setItem('token', authToken);
            }
        }

        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            const result = await apiCall('/auth/login', 'POST', {
                email,
                password
            }, false);
            
            showResult('loginResult', result, result.success);
            if (result.success && result.data.data.token) {
                authToken = result.data.data.token;
                localStorage.setItem('token', authToken);
            }
        }

        // Cart operations
        async function addToCart() {
            const productId = document.getElementById('productId').value;
            const quantity = parseInt(document.getElementById('quantity').value);
            
            const result = await apiCall('/cart/add', 'POST', {
                productId,
                quantity
            });
            
            showResult('cartResult', result, result.success);
        }

        async function getCart() {
            const result = await apiCall('/cart');
            showResult('cartResult', result, result.success);
        }

        async function clearCart() {
            const result = await apiCall('/cart/clear', 'DELETE');
            showResult('cartResult', result, result.success);
        }

        // Order operations
        async function createOrder() {
            const shippingAddress = {
                street: document.getElementById('street').value,
                city: document.getElementById('city').value,
                postalCode: document.getElementById('postalCode').value,
                country: document.getElementById('country').value
            };
            
            const paymentMethod = document.getElementById('paymentMethod').value;
            
            const result = await apiCall('/orders', 'POST', {
                shippingAddress,
                paymentMethod
            });
            
            showResult('orderResult', result, result.success);
            
            // Auto-fill order ID for cancel operation
            if (result.success && result.data.data.order._id) {
                document.getElementById('orderIdToCancel').value = result.data.data.order._id;
                document.getElementById('orderIdToUpdate').value = result.data.data.order._id;
            }
        }

        async function getOrders() {
            const result = await apiCall('/orders');
            showResult('orderResult', result, result.success);
        }

        async function cancelOrder() {
            const orderId = document.getElementById('orderIdToCancel').value;
            if (!orderId) {
                alert('  Order ID');
                return;
            }
            
            const result = await apiCall(`/orders/${orderId}/cancel`, 'POST');
            showResult('adminResult', result, result.success);
        }

        async function updateOrderStatus() {
            const orderId = document.getElementById('orderIdToUpdate').value;
            const newStatus = document.getElementById('newStatus').value;
            
            if (!orderId) {
                alert('  Order ID');
                return;
            }
            
            const result = await apiCall(`/orders/${orderId}/status`, 'PUT', {
                status: newStatus
            });
            showResult('adminResult', result, result.success);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            if (authToken) {
                showResult('loginResult', { message: 'Already logged in with existing token' }, true);
            }
        });
    </script>
</body>
</html>